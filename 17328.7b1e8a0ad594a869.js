"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[17328],{17328:function(e,t,n){n.r(t),n.d(t,{default:function(){return Z}});var r=n(35835),s=n(98431),a=n(34587),o=n.n(a),i=n(67597),c=n(29100),l=n(59613),u=n(68685),d=n(57611),f=function(){return(0,d.jsxs)("svg",{width:21,height:20,viewBox:"0 0 21 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,d.jsx)("path",{d:"M14.1854 16.1905C14.1854 18.2944 12.4798 20 10.3758 20C8.2719 20 6.56631 18.2944 6.56631 16.1905C6.56631 14.0865 8.2719 12.381 10.3758 12.381C12.4798 12.381 14.1854 14.0865 14.1854 16.1905Z",fill:"#EDF2F7"}),(0,d.jsx)("path",{d:"M17.5962 6.64364C17.2832 2.88844 14.1441 0 10.3759 0V0C6.60764 0 3.46849 2.88844 3.15555 6.64364L2.90405 9.66168C2.80718 10.8241 2.44472 11.9487 1.8446 12.9489L1.0474 14.2776C0.372866 15.4018 0.746216 16.5579 2.04461 16.7397C3.55482 16.9511 6.10246 17.1429 10.3759 17.1429C14.6493 17.1429 17.1969 16.9511 18.7071 16.7397C20.0055 16.5579 20.3788 15.4018 19.7043 14.2776L18.9071 12.9489C18.307 11.9487 17.9445 10.8241 17.8477 9.66168L17.5962 6.64364Z",fill:"#718096"}),(0,d.jsx)("path",{d:"M17.9949 2.85714C17.9949 4.4351 16.7157 5.71429 15.1378 5.71429C13.5598 5.71429 12.2806 4.4351 12.2806 2.85714C12.2806 1.27919 13.5598 0 15.1378 0C16.7157 0 17.9949 1.27919 17.9949 2.85714Z",fill:"#A0AEC0",fillOpacity:.9})]})},x=n(2844),m=n(62049),p=n.n(m),h=n(99014),v=n(61395),b=n(9134),j=n.n(b),g=n(11198),w=n(66408),k=n(74657);function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){(0,x.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C=function(e){var t=e.notif,n=e.markAsSeen,r=j()({"flex flex-col w-full":!0,"text-sm text-bone-900 dark:text-bone-200 font-700":t.unread,"text-sm text-bone-700 dark:text-bone-500 font-600":!t.unread,"cursor-pointer":t.meta.contract_uuid}),s=j()({"hover:text-azureblue dark:hover:text-cyan":t.meta.contract_uuid||"direct_message"==t.type}),a=j()({"text-xs font-400":!0,"text-bone-700 dark:text-bone-500":t.unread,"text-bone-600 dark:text-bone-600":!t.unread}),o=function(){t.unread&&n(t.id),e.setIsOpen(!1)};return t.meta.contract_uuid?(0,d.jsx)(p(),{href:"/contract/".concat(t.meta.contract_uuid,"/"),prefetch:!1,children:(0,d.jsx)("a",{className:"flex flow-row items-center",onClick:o,children:(0,d.jsxs)("div",{className:r,children:[(0,d.jsx)("div",{className:s,children:t.title}),(0,d.jsx)("div",{className:a,children:t.description}),(0,d.jsx)("div",{className:"text-xs font-400 text-bone-600 dark:text-bone-600",children:t.since})]})})}):"direct_message"==t.type?(0,d.jsx)(p(),{href:"/dm/".concat(t.meta.room_uuid,"/"),prefetch:!1,children:(0,d.jsx)("a",{className:"flex flow-row items-center",onClick:o,children:(0,d.jsxs)("div",{className:r,children:[(0,d.jsx)("div",{className:s,children:t.title}),(0,d.jsx)("div",{className:"text-xs font-400 text-bone-600 dark:text-bone-600",children:t.since})]})})}):(0,d.jsx)("div",{className:"flex flow-row items-center",onClick:o,children:(0,d.jsxs)("div",{className:r,children:[(0,d.jsx)("div",{className:s,children:t.title}),(0,d.jsx)("div",{className:a,children:t.description}),(0,d.jsx)("div",{className:"text-xs font-400 text-bone-600 dark:text-bone-600",children:t.since})]})})},O=function(){return(0,d.jsx)("div",{className:"bg-white dark:bg-ocean-800 rounded-lg w-full animate-pulse",style:{height:"80px"}})},_=function(e){var t,n,a,f,x,m=i.useRef(),p=(0,g.Z)(k),b=(0,s.Z)(p,1)[0],j=(0,v.Z)("unauth-common").t,N=(0,w.Z)(),_=(0,c.a)(),Z=_.authData,D=_.refreshUserData,E=(0,u.q)(),L=E.notifs,P=E.fetchUserNotifs,S=E.fetchMoreNotifs,A=function(t){var n,r=(null===m||void 0===m?void 0:m.current)||null;r&&(r.contains(t.target)||null!==(n=e.bell)&&void 0!==n&&n.current.contains(t.target)||e.setIsOpen(!1))};i.useEffect((function(){return document.addEventListener("mousedown",A),function(){document.removeEventListener("mousedown",A)}}),[]);var I=i.useState({response:void 0,status:"",errors:void 0}),R=(0,s.Z)(I,2),F=R[0],M=R[1],T=i.useState({data:{},status:""}),q=(0,s.Z)(T,2),z=q[0],B=q[1],U=null===(t=L.data)||void 0===t||null===(n=t.results)||void 0===n?void 0:n.map((function(t){return(0,d.jsx)(C,{notif:t,setIsOpen:e.setIsOpen,markAsSeen:function(e){return H(e)}},t.id)})),H=function(){var e=(0,r.Z)(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="/api/v2/notif/mark-read/".concat(t,"/"),e.next=3,(0,l.jB)(n,{});case 3:e.sent.ok?(B((function(e){return y(y({},e),{},{status:"success"})})),P()):(B((function(e){return y(y({},e),{},{status:"error"})})),N.error(j("unauth-common:sorryThisRequestFailed")));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),V=function(){var e=(0,r.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return B((function(e){return y(y({},e),{},{status:"loading"})})),"/api/announcements/mark-all-read/",e.next=4,(0,l.jB)("/api/announcements/mark-all-read/",{});case 4:e.sent.ok?(B((function(e){return y(y({},e),{},{status:"success"})})),P()):(B((function(e){return y(y({},e),{},{status:"error"})})),N.error(j("unauth-common:sorryThisRequestFailed")));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=(0,r.Z)(o().mark((function e(t){var n,r,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M((function(e){return y(y({},e),{},{status:"loading",errors:void 0})})),n={sound_notifications:t},"/api/rest-auth/user/",e.next=5,(0,l.fv)("/api/rest-auth/user/",n);case 5:if(!(r=e.sent).ok){e.next=15;break}return e.next=9,r.json();case 9:if(s=e.sent,M((function(e){return y(y({},e),{},{data:s,status:"success",errors:void 0})})),t){N.success(j("weWillNotifyYouForNewTrades"));try{b()}catch(o){console.log(o)}}else N.error(j("doNotDisturbModeActivated"));D(),e.next=19;break;case 15:return e.next=17,r.json();case 17:a=e.sent,M((function(e){return y(y({},e),{},{status:"error",errors:a})}));case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,d.jsx)(h.ww.div,{initial:!1,animate:e.isNotifListOpen?"open":"closed",variants:{closed:{visibility:"hidden",opacity:0,y:-20},open:{visibility:"visible",opacity:1,transition:{delay:.1},y:0}},className:"z-50 origin-top-right fixed top-12 left-0 right-0 w-full mx-auto mt-2 rounded-md shadow-lg lg:origin-top lg:absolute lg:right-0 lg:top-auto lg:left-auto lg:w-96 lg:mt-3",ref:m,children:(0,d.jsxs)("div",{className:"rounded-lg bg-white dark:bg-ocean-700 shadow-xs p-3 max-h-96 overflow-y-auto",role:"menu","aria-orientation":"vertical","aria-labelledby":"options-menu",onScroll:function(e){var t=e.target.scrollHeight-e.target.offsetHeight-e.target.scrollTop;t>0&&t<50&&S()},children:[(0,d.jsxs)("div",{className:"flex flow-row items-center justify-between",children:[(0,d.jsxs)("div",{className:"text-sm text-bone-700 dark:text-bone-500 font-600",children:[(0,d.jsx)("span",{className:"mr-1",children:j("notifications")}),"True"==(null===(a=Z.data)||void 0===a?void 0:a.sound_notifications)||1==(null===(f=Z.data)||void 0===f?void 0:f.sound_notifications)?(0,d.jsx)("i",{className:"lcs-icon volume-up cursor-pointer text-xl text-azureblue dark:text-cyan",onClick:function(){return W(!1)},children:"\ue80c"}):(0,d.jsx)("i",{className:"lcs-icon icon-volume-off cursor-pointer text-xl text-cherry",onClick:function(){return W(!0)},children:"\ue80b"}),"loading"==F.status&&(0,d.jsx)("i",{className:"lcs-icon icon-spin4 animate-spin mr-2 text-bone-500",children:"\ue834"})]}),(null===(x=L.data)||void 0===x?void 0:x.unread_count)>0?(0,d.jsxs)("div",{className:"text-sm text-azureblue dark:text-cyan hover:underline cursor-pointer",onClick:V,children:["loading"==z.status&&(0,d.jsx)("i",{className:"lcs-icon icon-spin4 animate-spin mr-2 text-bone-500",children:"\ue834"}),j("markAllAsRead")]}):(0,d.jsx)("div",{className:"text-sm text-bone-700 dark:text-bone-500",children:j("allNotifsRead")})]}),(0,d.jsxs)("div",{className:"flex flex-col gap-y-4 mt-3",children:[U,"loading"==L.status&&(0,d.jsx)(O,{})]})]})})},Z=function(){var e,t=i.useState(!1),n=(0,s.Z)(t,2),a=n[0],x=n[1],m=i.useRef(),p=(0,u.q)(),h=p.notifs,v=p.fetchUserNotifs,b=(0,c.a)().authData,j=function(){var e=(0,r.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/api/announcements/mark-all-seen/",e.next=3,(0,l.jB)("/api/announcements/mark-all-seen/",{});case 3:if(!(t=e.sent).ok){e.next=8;break}return e.next=7,t.json();case 7:v();case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return b.loggedIn?(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsxs)("button",{onClick:function(){var e;(null===(e=h.data)||void 0===e?void 0:e.unseen_count)>0&&j(),x(!a)},className:"flex overflow-hidden text-bone-300 duration-300 transition ease-out focus:outline-none lg:mt-1 mr-6 mt-px lg:mr-2",children:[(0,d.jsx)("div",{ref:m,className:"duration-300 transition ease-out opacity-70 hover:opacity-100",children:(0,d.jsx)(f,{})}),(null===(e=h.data)||void 0===e?void 0:e.unseen_count)>0&&(0,d.jsx)("span",{className:"absolute -top-1 lg:-top-0 left-3 px-1 text-xs w-3 h-3 rounded-full bg-cherry font-600"})]}),(0,d.jsx)(_,{bell:m,isNotifListOpen:a,setIsOpen:x})]}):null}}}]);